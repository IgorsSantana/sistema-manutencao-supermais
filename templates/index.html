{% extends "base.html" %}

{% block title %}Dashboard - Sistema de Manutenção{% endblock %}

{% block content %}
<!-- Welcome Hero Section -->
<div class="row mb-6">
    <div class="col">
        <div class="hero-banner">
            <div class="hero-content">
                <h1 class="text-center mt-4 mb-2">🔧 Sistema de Manutenção</h1>
                <p class="text-center text-light mb-0">Gerencie lojas, frota e manutenções de forma eficiente</p>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Statistics Dashboard -->
<div class="stats-grid mt-4">
    <div class="stat-card">
        <div class="stat-icon">🏪</div>
        <div class="stat-number">{{ total_lojas }}</div>
        <div class="stat-label">Lojas Cadastradas</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">🚗</div>
        <div class="stat-number">{{ total_veiculos }}</div>
        <div class="stat-label">Veículos na Frota</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">🔧</div>
        <div class="stat-number">{{ total_manutencoes }}</div>
        <div class="stat-label">Manutenções Realizadas</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">💰</div>
        <div class="stat-number">R$ <span id="total-gasto">-</span></div>
        <div class="stat-label">Total Investido</div>
    </div>
</div>

<!-- Enhanced Quick Actions -->
<div class="card">
    <div class="card-header">
        <span class="card-header-icon">🚀</span>
        <h3>Ações Rápidas</h3>
    </div>
    <div class="card-body">
        <div class="action-grid">
            <a href="/manutencoes/cadastrar" class="action-item primary" role="button">
                <span class="action-icon">🔧</span>
                <div class="action-content">
                    <h4>Nova Manutenção</h4>
                    <p>Registrar nova manutenção</p>
                </div>
            </a>
            <a href="/lojas/cadastrar" class="action-item" role="button">
                <span class="action-icon">🏪</span>
                <div class="action-content">
                    <h4>Nova Loja</h4>
                    <p>Cadastrar nova loja</p>
                </div>
            </a>
            <a href="/veiculos/cadastrar" class="action-item" role="button">
                <span class="action-icon">🚗</span>
                <div class="action-content">
                    <h4>Novo Veículo</h4>
                    <p>Adicionar à frota</p>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Enhanced Lojas Cadastradas -->
<div class="card">
    <div class="card-header">
        <span class="card-header-icon">🏪</span>
        <h3>Lojas Cadastradas</h3>
        {% if lojas %}<span class="badge">{{ lojas|length }}</span>{% endif %}
    </div>
    <div class="card-body">
        {% if not lojas %}
            <div class="empty-state">
                <div class="empty-state-icon">🏪</div>
                <h4>Nenhuma loja cadastrada</h4>
                <p>Comece cadastrando a primeira loja para o sistema</p>
                <a href="/lojas/cadastrar" class="btn btn-primary">Cadastrar Primeira Loja</a>
            </div>
        {% else %}
            <div class="entity-grid">
                {% for loja in lojas %}
                    <div class="entity-card">
                        <div class="entity-header">
                            <span class="entity-icon">🏪</span>
                            <h4>{{ loja.nome }}</h4>
                        </div>
                        <div class="entity-content">
                            {% if loja.endereco %}
                                <div class="entity-info">
                                    <span class="entity-info-icon">📍</span>
                                    <span>{{ loja.endereco }}</span>
                                </div>
                            {% endif %}
                            {% if loja.telefone %}
                                <div class="entity-info">
                                    <span class="entity-info-icon">📞</span>
                                    <span>{{ loja.telefone }}</span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="entity-actions">
                            <a href="/lojas/{{ loja.id }}" class="btn btn-secondary w-full">
                                Ver Detalhes
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>

<!-- Enhanced Frota de Veículos -->
<div class="card">
    <div class="card-header">
        <span class="card-header-icon">🚗</span>
        <h3>Frota de Veículos</h3>
        {% if veiculos %}<span class="badge">{{ veiculos|length }}</span>{% endif %}
    </div>
    <div class="card-body">
        {% if not veiculos %}
            <div class="empty-state">
                <div class="empty-state-icon">🚗</div>
                <h4>Nenhum veículo cadastrado</h4>
                <p>Comece adicionando o primeiro veículo à sua frota</p>
                <a href="/veiculos/cadastrar" class="btn btn-primary">Cadastrar Primeiro Veículo</a>
            </div>
        {% else %}
            <div class="entity-grid">
                {% for veiculo in veiculos %}
                    <div class="entity-card">
                        <div class="entity-header">
                            <span class="entity-icon">🚗</span>
                            <h4>{{ veiculo.placa }}</h4>
                        </div>
                        <div class="entity-content">
                            <div class="entity-info">
                                <span class="entity-info-icon">🚗</span>
                                <span><strong>{{ veiculo.modelo }}</strong></span>
                            </div>
                            {% if veiculo.marca %}
                                <div class="entity-info">
                                    <span class="entity-info-icon">🏭</span>
                                    <span>{{ veiculo.marca }}</span>
                                </div>
                            {% endif %}
                            {% if veiculo.ano %}
                                <div class="entity-info">
                                    <span class="entity-info-icon">📅</span>
                                    <span>{{ veiculo.ano }}</span>
                                </div>
                            {% endif %}
                            {% if veiculo.cor %}
                                <div class="entity-info">
                                    <span class="entity-info-icon">🎨</span>
                                    <span>{{ veiculo.cor }}</span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="entity-actions">
                            <a href="/veiculos/{{ veiculo.id }}" class="btn btn-secondary w-full">
                                Ver Detalhes
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>

<!-- Enhanced Manutenções Recentes -->
<div class="card">
    <div class="card-header">
        <span class="card-header-icon">🔧</span>
        <h3>Manutenções Recentes</h3>
        {% if manutencoes_recentes %}<span class="badge">{{ manutencoes_recentes|length }}</span>{% endif %}
    </div>
    <div class="card-body">
        {% if not manutencoes_recentes %}
            <div class="empty-state">
                <div class="empty-state-icon">🔧</div>
                <h4>Nenhuma manutenção registrada</h4>
                <p>Comece registrando a primeira manutenção do sistema</p>
                <a href="/manutencoes/cadastrar" class="btn btn-primary">Registrar Primeira Manutenção</a>
            </div>
        {% else %}
            <div class="maintenance-list">
                {% for manutencao in manutencoes_recentes %}
                    <div class="maintenance-card {{ manutencao.tipo }}">
                        <div class="maintenance-header">
                            <div class="maintenance-icon">
                                {% if manutencao.tipo == 'loja' %}🏪{% else %}🚗{% endif %}
                            </div>
                            <div class="maintenance-info">
                                <h4>{{ manutencao.titulo }}</h4>
                                <p class="date">
                                    📅 {{ manutencao.data_manutencao.strftime('%d/%m/%Y') }}
                                    {% if manutencao.tipo == 'loja' and manutencao.loja %}
                                        • 🏪 {{ manutencao.loja.nome }}
                                    {% elif manutencao.tipo == 'veiculo' and manutencao.veiculo %}
                                        • 🚗 {{ manutencao.veiculo.placa }} - {{ manutencao.veiculo.modelo }}
                                    {% endif %}
                                </p>
                                {% if manutencao.descricao %}
                                    <p class="maintenance-description">{{ manutencao.descricao[:100] }}{% if manutencao.descricao|length > 100 %}...{% endif %}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="maintenance-footer">
                            <div class="price">R$ {{ "%.2f"|format(manutencao.preco_total) }}</div>
                            <a href="/manutencoes/{{ manutencao.id }}" class="btn btn-secondary">
                                Ver Detalhes
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Carregar estatísticas via API
    fetch('/api/estatisticas')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-gasto').textContent = data.total_gasto.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        })
        .catch(error => {
            console.error('Erro ao carregar estatísticas:', error);
        });
</script>
{% endblock %}