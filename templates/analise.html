{% extends "base.html" %}

{% block title %}An√°lise de Manuten√ß√µes - Sistema de Manuten√ß√£o{% endblock %}

{% block header_title %}An√°lise de Manuten√ß√µes{% endblock %}

{% block content %}
<!-- ===== DESKTOP LAYOUT ===== -->
<div class="analytics-desktop">
    <!-- Sidebar de Filtros (Desktop) -->
    <aside class="filters-sidebar">
        <div class="sidebar-header">
            <h3>üìä Filtros</h3>
        </div>
        <div class="sidebar-content">
            <form method="GET" action="{{ url_for('analise') }}" class="filters-form">
                <div class="form-group">
                    <label for="data_inicio">üìÖ Data In√≠cio</label>
                    <input type="date" id="data_inicio" name="data_inicio" 
                           value="{{ filtros.data_inicio or '' }}" 
                           class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="data_fim">üìÖ Data Fim</label>
                    <input type="date" id="data_fim" name="data_fim" 
                           value="{{ filtros.data_fim or '' }}" 
                           class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="tipo">üè∑Ô∏è Tipo</label>
                    <select id="tipo" name="tipo" class="form-control">
                        <option value="todas" {% if filtros.tipo == 'todas' %}selected{% endif %}>
                            Todas
                        </option>
                        <option value="loja" {% if filtros.tipo == 'loja' %}selected{% endif %}>
                            üè™ Lojas
                        </option>
                        <option value="veiculo" {% if filtros.tipo == 'veiculo' %}selected{% endif %}>
                            üöó Ve√≠culos
                        </option>
                    </select>
                </div>
                
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">
                        üîç Aplicar
                    </button>
                    <a href="{{ url_for('analise') }}" class="btn btn-secondary">
                        üóëÔ∏è Limpar
                    </a>
                </div>
            </form>
        </div>
    </aside>

    <!-- Conte√∫do Principal (Desktop) -->
    <main class="analytics-main">
        <!-- KPIs Header -->
        <section class="kpis-section">
            <div class="kpi-grid">
                <div class="kpi-card primary">
                    <div class="kpi-icon">üîß</div>
                    <div class="kpi-content">
                        <div class="kpi-number">{{ resumo.total_manutencoes }}</div>
                        <div class="kpi-label">Total Manuten√ß√µes</div>
                    </div>
                </div>
                
                <div class="kpi-card success">
                    <div class="kpi-icon">üí∞</div>
                    <div class="kpi-content">
                        <div class="kpi-number">R$ {{ "%.2f"|format(resumo.total_gasto) }}</div>
                        <div class="kpi-label">Valor Total</div>
                    </div>
                </div>
                
                <div class="kpi-card info">
                    <div class="kpi-icon">üè™</div>
                    <div class="kpi-content">
                        <div class="kpi-number">{{ resumo.manutencoes_loja }}</div>
                        <div class="kpi-label">Lojas</div>
                    </div>
                </div>
                
                <div class="kpi-card warning">
                    <div class="kpi-icon">üöó</div>
                    <div class="kpi-content">
                        <div class="kpi-number">{{ resumo.manutencoes_veiculo }}</div>
                        <div class="kpi-label">Ve√≠culos</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- An√°lise por Tipo -->
        <section class="analysis-section">
            <div class="section-header">
                <h3>üìà An√°lise por Tipo</h3>
            </div>
            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="card-header">
                        <h4>üè™ Lojas</h4>
                        <div class="card-value">R$ {{ "%.2f"|format(resumo.gasto_loja) }}</div>
                    </div>
                    <div class="card-content">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ (resumo.gasto_loja / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0 }}%"></div>
                        </div>
                        <div class="progress-label">{{ "%.1f"|format((resumo.gasto_loja / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0) }}% do total</div>
                    </div>
                </div>
                
                <div class="analysis-card">
                    <div class="card-header">
                        <h4>üöó Ve√≠culos</h4>
                        <div class="card-value">R$ {{ "%.2f"|format(resumo.gasto_veiculo) }}</div>
                    </div>
                    <div class="card-content">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ (resumo.gasto_veiculo / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0 }}%"></div>
                        </div>
                        <div class="progress-label">{{ "%.1f"|format((resumo.gasto_veiculo / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0) }}% do total</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tabelas de An√°lise -->
        <section class="tables-section">
            <div class="tables-grid">
                <!-- An√°lise por Loja -->
                {% if lojas_analise %}
                <div class="table-card">
                    <div class="table-header">
                        <h4>üè™ Por Loja</h4>
                    </div>
                    <div class="table-content">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Loja</th>
                                    <th>Qtd</th>
                                    <th>Valor</th>
                                    <th>M√©dia</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for loja, dados in lojas_analise.items() %}
                                <tr>
                                    <td><strong>{{ loja }}</strong></td>
                                    <td>{{ dados.total }}</td>
                                    <td>R$ {{ "%.2f"|format(dados.gasto) }}</td>
                                    <td>R$ {{ "%.2f"|format(dados.gasto / dados.total) if dados.total > 0 else 0 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}

                <!-- An√°lise por Ve√≠culo -->
                {% if veiculos_analise %}
                <div class="table-card">
                    <div class="table-header">
                        <h4>üöó Por Ve√≠culo</h4>
                    </div>
                    <div class="table-content">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Qtd</th>
                                    <th>Valor</th>
                                    <th>M√©dia</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for placa, dados in veiculos_analise.items() %}
                                <tr>
                                    <td><strong>{{ placa }}</strong></td>
                                    <td>{{ dados.total }}</td>
                                    <td>R$ {{ "%.2f"|format(dados.gasto) }}</td>
                                    <td>R$ {{ "%.2f"|format(dados.gasto / dados.total) if dados.total > 0 else 0 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
            </div>
        </section>

        <!-- An√°lise Mensal -->
        {% if manutencoes_mensais %}
        <section class="monthly-section">
            <div class="section-header">
                <h3>üìÖ Evolu√ß√£o Mensal</h3>
            </div>
            <div class="monthly-table-container">
                <table class="monthly-table">
                    <thead>
                        <tr>
                            <th>M√™s/Ano</th>
                            <th>Manuten√ß√µes</th>
                            <th>Valor Gasto</th>
                            <th>M√©dia</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mes, dados in manutencoes_mensais.items() %}
                        <tr>
                            <td><strong>{{ mes }}</strong></td>
                            <td>{{ dados.total }}</td>
                            <td>R$ {{ "%.2f"|format(dados.gasto) }}</td>
                            <td>R$ {{ "%.2f"|format(dados.gasto / dados.total) if dados.total > 0 else 0 }}</td>
                            <td>
                                <div class="mini-progress">
                                    <div class="mini-progress-fill" style="width: {{ (dados.gasto / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0 }}%"></div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- Manuten√ß√µes Recentes -->
        {% if manutencoes %}
        <section class="recent-section">
            <div class="section-header">
                <h3>üìã Manuten√ß√µes Recentes</h3>
            </div>
            <div class="recent-table-container">
                <table class="recent-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for manutencao in manutencoes %}
                        <tr>
                            <td>{{ manutencao.data_manutencao.strftime('%d/%m/%Y') }}</td>
                            <td>
                                {% if manutencao.tipo == 'loja' %}
                                    <span class="type-badge loja">üè™ {{ manutencao.loja.nome if manutencao.loja else 'Loja n√£o encontrada' }}</span>
                                {% else %}
                                    <span class="type-badge veiculo">üöó {{ manutencao.veiculo.placa if manutencao.veiculo else 'Ve√≠culo n√£o encontrado' }}</span>
                                {% endif %}
                            </td>
                            <td class="description">
                                <a href="{{ url_for('detalhes_manutencao', manutencao_id=manutencao.id) }}" 
                                   style="color: var(--color-text); text-decoration: none;">
                                    {{ manutencao.descricao[:50] }}{% if manutencao.descricao|length > 50 %}...{% endif %}
                                </a>
                            </td>
                            <td class="value">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>R$ {{ "%.2f"|format(manutencao.preco_total) }}</span>
                                    <div style="display: flex; gap: 0.25rem;">
                                        <a href="{{ url_for('editar_manutencao', manutencao_id=manutencao.id) }}" 
                                           class="btn btn-primary btn-sm" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                            ‚úèÔ∏è
                                        </a>
                                        <form method="POST" action="{{ url_for('apagar_manutencao', manutencao_id=manutencao.id) }}" 
                                              style="display: inline;" 
                                              onsubmit="return confirm('‚ö†Ô∏è Tem certeza que deseja apagar esta manuten√ß√£o?')">
                                            <button type="submit" class="btn btn-error btn-sm" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}
    </main>
</div>

<!-- ===== MOBILE LAYOUT (Mantido Original) ===== -->
<div class="analytics-mobile">
    <!-- Filtros Mobile -->
    <div class="card mb-lg">
        <div class="card-header">
            <h3>üìä Filtros de An√°lise</h3>
        </div>
        <div class="card-body">
            <form method="GET" action="{{ url_for('analise') }}" class="form-grid">
                <div class="form-group">
                    <label for="data_inicio_mobile">üìÖ Data In√≠cio</label>
                    <input type="date" id="data_inicio_mobile" name="data_inicio" 
                           value="{{ filtros.data_inicio or '' }}" 
                           class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="data_fim_mobile">üìÖ Data Fim</label>
                    <input type="date" id="data_fim_mobile" name="data_fim" 
                           value="{{ filtros.data_fim or '' }}" 
                           class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="tipo_mobile">üè∑Ô∏è Tipo de Manuten√ß√£o</label>
                    <select id="tipo_mobile" name="tipo" class="form-control">
                        <option value="todas" {% if filtros.tipo == 'todas' %}selected{% endif %}>
                            Todas as Manuten√ß√µes
                        </option>
                        <option value="loja" {% if filtros.tipo == 'loja' %}selected{% endif %}>
                            üè™ Apenas Lojas
                        </option>
                        <option value="veiculo" {% if filtros.tipo == 'veiculo' %}selected{% endif %}>
                            üöó Apenas Ve√≠culos
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        üîç Aplicar Filtros
                    </button>
                    <a href="{{ url_for('analise') }}" class="btn btn-secondary">
                        üóëÔ∏è Limpar Filtros
                    </a>
                </div>
            </form>
        </div>
    </div>

<!-- ===== RESUMO EXECUTIVO ===== -->
<div class="stats-grid mb-lg">
    <div class="stat-card">
        <div class="stat-number">{{ resumo.total_manutencoes }}</div>
        <div class="stat-label">Total de Manuten√ß√µes</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">R$ {{ "%.2f"|format(resumo.total_gasto) }}</div>
        <div class="stat-label">Valor Total Gasto</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ resumo.manutencoes_loja }}</div>
        <div class="stat-label">Manuten√ß√µes em Lojas</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ resumo.manutencoes_veiculo }}</div>
        <div class="stat-label">Manuten√ß√µes em Ve√≠culos</div>
    </div>
</div>

<!-- ===== AN√ÅLISE POR TIPO ===== -->
<div class="card mb-lg">
    <div class="card-header">
        <h3>üìà An√°lise por Tipo</h3>
    </div>
    <div class="card-body">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">R$ {{ "%.2f"|format(resumo.gasto_loja) }}</div>
                <div class="stat-label">Gasto com Lojas</div>
                <div class="text-muted">
                    {{ "%.1f"|format((resumo.gasto_loja / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0) }}% do total
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number">R$ {{ "%.2f"|format(resumo.gasto_veiculo) }}</div>
                <div class="stat-label">Gasto com Ve√≠culos</div>
                <div class="text-muted">
                    {{ "%.1f"|format((resumo.gasto_veiculo / resumo.total_gasto * 100) if resumo.total_gasto > 0 else 0) }}% do total
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== AN√ÅLISE POR LOJA ===== -->
{% if lojas_analise %}
<div class="card mb-lg">
    <div class="card-header">
        <h3>üè™ An√°lise por Loja</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Loja</th>
                        <th>Manuten√ß√µes</th>
                        <th>Valor Gasto</th>
                        <th>M√©dia por Manuten√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for loja, dados in lojas_analise.items() %}
                    <tr>
                        <td><strong>{{ loja }}</strong></td>
                        <td>{{ dados.total }}</td>
                        <td>R$ {{ "%.2f"|format(dados.gasto) }}</td>
                        <td>R$ {{ "%.2f"|format(dados.gasto / dados.total) if dados.total > 0 else 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- ===== AN√ÅLISE POR VE√çCULO ===== -->
{% if veiculos_analise %}
<div class="card mb-lg">
    <div class="card-header">
        <h3>üöó An√°lise por Ve√≠culo</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Placa</th>
                        <th>Manuten√ß√µes</th>
                        <th>Valor Gasto</th>
                        <th>M√©dia por Manuten√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for placa, dados in veiculos_analise.items() %}
                    <tr>
                        <td><strong>{{ placa }}</strong></td>
                        <td>{{ dados.total }}</td>
                        <td>R$ {{ "%.2f"|format(dados.gasto) }}</td>
                        <td>R$ {{ "%.2f"|format(dados.gasto / dados.total) if dados.total > 0 else 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- ===== AN√ÅLISE MENSAL ===== -->
{% if manutencoes_mensais %}
<div class="card mb-lg">
    <div class="card-header">
        <h3>üìÖ An√°lise Mensal</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>M√™s/Ano</th>
                        <th>Manuten√ß√µes</th>
                        <th>Valor Gasto</th>
                        <th>M√©dia por Manuten√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mes, dados in manutencoes_mensais.items() %}
                    <tr>
                        <td><strong>{{ mes }}</strong></td>
                        <td>{{ dados.total }}</td>
                        <td>R$ {{ "%.2f"|format(dados.gasto) }}</td>
                        <td>R$ {{ "%.2f"|format(dados.gasto / dados.total) if dados.total > 0 else 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- ===== AN√ÅLISE POR PRIORIDADE REMOVIDA ===== -->

<!-- ===== MANUTEN√á√ïES RECENTES ===== -->
{% if manutencoes %}
<div class="card">
    <div class="card-header">
        <h3>üìã Manuten√ß√µes Recentes</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Tipo</th>
                        <th>Descri√ß√£o</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for manutencao in manutencoes %}
                    <tr>
                        <td>{{ manutencao.data_manutencao.strftime('%d/%m/%Y') }}</td>
                        <td>
                            {% if manutencao.tipo == 'loja' %}
                                üè™ {{ manutencao.loja.nome if manutencao.loja else 'Loja n√£o encontrada' }}
                            {% else %}
                                üöó {{ manutencao.veiculo.placa if manutencao.veiculo else 'Ve√≠culo n√£o encontrado' }}
                            {% endif %}
                        </td>
                        <td>{{ manutencao.descricao[:50] }}{% if manutencao.descricao|length > 50 %}...{% endif %}</td>
                        <td>R$ {{ "%.2f"|format(manutencao.preco_total) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

</div>
{% endblock %}

{% block extra_css %}
<style>
    /* ===== DESKTOP ANALYTICS LAYOUT ===== */
    
    /* Desktop Layout - Apenas para telas >= 1024px */
    @media (min-width: 1024px) {
        .analytics-mobile {
            display: none !important;
        }
        
        .analytics-desktop {
            display: block;
            min-height: 100vh;
            background: var(--color-background);
        }
        
        .analytics-desktop {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: var(--space-md);
            padding: var(--space-md);
            width: 100%;
            max-width: none;
            margin: 0;
        }
        
        /* Sidebar de Filtros */
        .filters-sidebar {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
            height: fit-content;
            position: sticky;
            top: var(--space-md);
        }
        
        .sidebar-header {
            padding: var(--space-sm);
            border-bottom: 1px solid var(--color-border);
            background: var(--primary-50);
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }
        
        .sidebar-content {
            padding: var(--space-sm);
        }
        
        .filters-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .filter-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        /* Conte√∫do Principal */
        .analytics-main {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        /* KPIs Section */
        .kpis-section {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
            padding: var(--space-md);
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-sm);
        }
        
        .kpi-card {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            transition: all var(--transition);
        }
        
        .kpi-card.primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
        }
        
        .kpi-card.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .kpi-card.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        .kpi-card.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .kpi-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }
        
        .kpi-content {
            flex: 1;
        }
        
        .kpi-number {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            line-height: 1.2;
        }
        
        .kpi-label {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            margin-top: var(--space-xs);
        }
        
        /* Sections */
        .analysis-section,
        .tables-section,
        .monthly-section,
        .recent-section {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
            overflow: hidden;
        }
        
        .section-header {
            padding: var(--space-sm) var(--space-md);
            background: var(--primary-50);
            border-bottom: 1px solid var(--color-border);
        }
        
        .section-header h3 {
            margin: 0;
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }
        
        /* Analysis Cards */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
            padding: var(--space-md);
        }
        
        .analysis-card {
            background: var(--gray-50);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            border: 1px solid var(--color-border);
        }
        
        .analysis-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }
        
        .analysis-card h4 {
            margin: 0;
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }
        
        .card-value {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--space-xs);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
            transition: width 0.3s ease;
        }
        
        .progress-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            text-align: right;
        }
        
        /* Tables Grid */
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
            padding: var(--space-md);
        }
        
        .table-card {
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            overflow: hidden;
        }
        
        .table-header {
            padding: var(--space-md) var(--space-lg);
            background: var(--primary-100);
            border-bottom: 1px solid var(--color-border);
        }
        
        .table-header h4 {
            margin: 0;
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }
        
        .table-content {
            padding: 0;
        }
        
        /* Analytics Tables */
        .analytics-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .analytics-table th,
        .analytics-table td {
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        
        .analytics-table th {
            background: var(--gray-100);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .analytics-table td {
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }
        
        .analytics-table tbody tr:hover {
            background: var(--primary-50);
        }
        
        /* Monthly Table */
        .monthly-table-container {
            padding: var(--space-md);
        }
        
        .monthly-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .monthly-table th,
        .monthly-table td {
            padding: var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        
        .monthly-table th {
            background: var(--gray-100);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-sm);
        }
        
        .monthly-table td {
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }
        
        .mini-progress {
            width: 60px;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .mini-progress-fill {
            height: 100%;
            background: var(--primary-500);
            transition: width 0.3s ease;
        }
        
        /* Recent Table */
        .recent-table-container {
            padding: var(--space-md);
        }
        
        .recent-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .recent-table th,
        .recent-table td {
            padding: var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        
        .recent-table th {
            background: var(--gray-100);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-sm);
        }
        
        .recent-table td {
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }
        
        .type-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }
        
        .type-badge.loja {
            background: var(--primary-100);
            color: var(--primary-700);
        }
        
        .type-badge.veiculo {
            background: var(--warning-100);
            color: var(--warning-700);
        }
        
        .description {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .value {
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
        }
    }
    
    /* ===== OTIMIZA√á√ÉO PARA TELAS GRANDES (1440px+) ===== */
    @media (min-width: 1440px) {
        .analytics-desktop {
            grid-template-columns: 280px 1fr;
            gap: var(--space-lg);
            padding: var(--space-lg);
        }
        
        .kpi-grid {
            gap: var(--space-md);
        }
        
        .analysis-grid,
        .tables-grid {
            gap: var(--space-md);
            padding: var(--space-lg);
        }
        
        .monthly-table-container,
        .recent-table-container {
            padding: var(--space-lg);
        }
        
        .section-header {
            padding: var(--space-md) var(--space-lg);
        }
    }
    
    /* ===== OTIMIZA√á√ÉO PARA TELAS MUITO GRANDES (1920px+) ===== */
    @media (min-width: 1920px) {
        .analytics-desktop {
            grid-template-columns: 300px 1fr;
            gap: var(--space-xl);
            padding: var(--space-xl);
        }
        
        .kpi-grid {
            gap: var(--space-lg);
        }
        
        .kpi-card {
            padding: var(--space-lg);
        }
        
        .kpi-number {
            font-size: var(--font-size-2xl);
        }
        
        .kpi-icon {
            font-size: 2.5rem;
        }
        
        .analysis-grid,
        .tables-grid {
            gap: var(--space-lg);
            padding: var(--space-xl);
        }
        
        .analysis-card {
            padding: var(--space-lg);
        }
        
        .monthly-table-container,
        .recent-table-container {
            padding: var(--space-xl);
        }
        
        .monthly-table th,
        .monthly-table td,
        .recent-table th,
        .recent-table td {
            padding: var(--space-md) var(--space-lg);
        }
        
        .description {
            max-width: 400px;
        }
        
        .section-header {
            padding: var(--space-lg) var(--space-xl);
        }
        
        .section-header h3 {
            font-size: var(--font-size-xl);
        }
        
        .sidebar-content {
            padding: var(--space-md);
        }
        
        .filters-form {
            gap: var(--space-md);
        }
    }
    
    /* ===== MOBILE LAYOUT (Mantido Original) ===== */
    
    /* Desktop esconde mobile */
    @media (min-width: 1024px) {
        .analytics-mobile {
            display: none !important;
        }
    }
    
    /* Mobile mostra apenas mobile */
    @media (max-width: 1023px) {
        .analytics-desktop {
            display: none !important;
        }
        
        .analytics-mobile {
            display: block;
        }
        
        /* Estilos originais mantidos para mobile */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-md);
        }
        
        .table th,
        .table td {
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        
        .table th {
            background-color: var(--gray-50);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-sm);
        }
        
        .table td {
            font-size: var(--font-size-sm);
        }
        
        .table tbody tr:hover {
            background-color: var(--gray-50);
        }
        
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .table {
                font-size: var(--font-size-xs);
            }
            
            .table th,
            .table td {
                padding: var(--space-xs) var(--space-sm);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-md);
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table th,
            .table td {
                padding: var(--space-xs);
                font-size: 0.75rem;
            }
        }
    }
</style>
{% endblock %}
