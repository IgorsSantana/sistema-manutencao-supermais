{% extends "base.html" %}

{% block title %}Cadastrar Manuten√ß√£o - Sistema de Manuten√ß√£o{% endblock %}

{% block content %}
<!-- ===== DESKTOP LAYOUT ===== -->
<div class="create-desktop">
    <div class="create-container">
        <!-- Header -->
        <div class="create-header">
            <div class="header-icon">üîß</div>
            <div class="header-content">
                <h1>Cadastrar Nova Manuten√ß√£o</h1>
                <p>Registre uma nova manuten√ß√£o no sistema</p>
            </div>
        </div>

        <!-- Formul√°rio Principal -->
        <form action="{{ url_for('cadastrar_manutencao') }}" method="POST" enctype="multipart/form-data" class="create-form">
            <!-- Se√ß√£o 1: Informa√ß√µes B√°sicas -->
            <div class="form-section">
                <div class="section-header">
                    <h3>üìã Informa√ß√µes B√°sicas</h3>
                </div>
                <div class="section-content">
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="tipo" class="form-label required">Tipo de Manuten√ß√£o</label>
                            <select id="tipo" name="tipo" required onchange="toggleTipoManutencao()" class="form-control">
                                <option value="">Selecione o tipo</option>
                                <option value="loja" {% if request.args.get('loja_id') %}selected{% endif %}>üè™ Loja</option>
                                <option value="veiculo" {% if request.args.get('veiculo_id') %}selected{% endif %}>üöó Ve√≠culo</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="data_manutencao" class="form-label">Data da Manuten√ß√£o</label>
                            <input type="date" id="data_manutencao" name="data_manutencao" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="titulo" class="form-label required">T√≠tulo da Manuten√ß√£o</label>
                        <input type="text" id="titulo" name="titulo" placeholder="Ex: Troca de l√¢mpadas, Manuten√ß√£o do ar-condicionado..." required class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="descricao" class="form-label">Descri√ß√£o</label>
                        <textarea id="descricao" name="descricao" rows="4" placeholder="Descreva os detalhes da manuten√ß√£o realizada, materiais utilizados, observa√ß√µes importantes..." class="form-control"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="preco_total" class="form-label">Pre√ßo Total (R$)</label>
                        <input type="number" id="preco_total" name="preco_total" step="0.01" min="0" placeholder="0.00" class="form-control">
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 2: Loja ou Ve√≠culo -->
            <div class="form-section">
                <div class="section-header">
                    <h3 id="section-tipo-title">Selecione o Tipo</h3>
                </div>
                <div class="section-content">
                    <div id="loja_select" class="tipo-select" style="display: none;">
                        <div class="form-group">
                            <label for="loja_id" class="form-label required">Loja</label>
                            <select id="loja_id" name="loja_id" class="form-control">
                                <option value="">Selecione a loja</option>
                                {% for loja in lojas %}
                                    <option value="{{ loja.id }}" {% if request.args.get('loja_id')|int == loja.id %}selected{% endif %}>
                                        {{ loja.nome }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div id="veiculo_select" class="tipo-select" style="display: none;">
                        <div class="form-group">
                            <label for="veiculo_id" class="form-label required">Ve√≠culo</label>
                            <select id="veiculo_id" name="veiculo_id" class="form-control">
                                <option value="">Selecione o ve√≠culo</option>
                                {% for veiculo in veiculos %}
                                    <option value="{{ veiculo.id }}" {% if request.args.get('veiculo_id')|int == veiculo.id %}selected{% endif %}>
                                        {{ veiculo.placa }} - {{ veiculo.modelo }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 3: Fotos -->
            <div class="form-section">
                <div class="section-header">
                    <h3>üì∑ Fotos da Manuten√ß√£o</h3>
                    <span class="section-subtitle">Opcional - Adicione fotos para documentar a manuten√ß√£o</span>
                </div>
                <div class="section-content">
                    <div class="upload-area" onclick="document.getElementById('fotos').click()">
                        <input type="file" id="fotos" name="fotos" multiple accept="image/*" style="display: none;">
                        <div class="upload-content">
                            <div class="upload-icon">üì∑</div>
                            <h4>Adicionar Fotos</h4>
                            <p>Clique para selecionar ou arraste as fotos aqui</p>
                            <small>Formatos: JPG, PNG, GIF (m√°x. 5MB cada)</small>
                        </div>
                    </div>
                    <div id="photo-preview" class="photo-preview"></div>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    üíæ Cadastrar Manuten√ß√£o
                </button>
                <a href="{{ url_for('listar_manutencoes') }}" class="btn btn-secondary btn-large">
                    ‚ùå Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<!-- ===== MOBILE LAYOUT ===== -->
<div class="create-mobile">
    <div class="mobile-header">
        <div class="mobile-icon">üîß</div>
        <div class="mobile-title">
            <h1>Nova Manuten√ß√£o</h1>
            <p>Registre uma manuten√ß√£o</p>
        </div>
    </div>

    <form action="{{ url_for('cadastrar_manutencao') }}" method="POST" enctype="multipart/form-data" class="mobile-form">
        <!-- Tipo e Data -->
        <div class="mobile-section">
            <h3>üìã B√°sico</h3>
            <div class="mobile-form-group">
                <label for="tipo_mobile" class="mobile-label required">Tipo</label>
                <select id="tipo_mobile" name="tipo" required onchange="toggleTipoManutencaoMobile()" class="mobile-input">
                    <option value="">Selecione</option>
                    <option value="loja" {% if request.args.get('loja_id') %}selected{% endif %}>üè™ Loja</option>
                    <option value="veiculo" {% if request.args.get('veiculo_id') %}selected{% endif %}>üöó Ve√≠culo</option>
                </select>
            </div>
            
            <div class="mobile-form-group">
                <label for="data_manutencao_mobile" class="mobile-label">Data</label>
                <input type="date" id="data_manutencao_mobile" name="data_manutencao" class="mobile-input">
            </div>
        </div>

        <!-- T√≠tulo e Descri√ß√£o -->
        <div class="mobile-section">
            <h3>üìù Detalhes</h3>
            <div class="mobile-form-group">
                <label for="titulo_mobile" class="mobile-label required">T√≠tulo</label>
                <input type="text" id="titulo_mobile" name="titulo" placeholder="Ex: Troca de l√¢mpadas" required class="mobile-input">
            </div>
            
            <div class="mobile-form-group">
                <label for="descricao_mobile" class="mobile-label">Descri√ß√£o</label>
                <textarea id="descricao_mobile" name="descricao" rows="3" placeholder="Detalhes da manuten√ß√£o..." class="mobile-input"></textarea>
            </div>
            
            <div class="mobile-form-group">
                <label for="preco_total_mobile" class="mobile-label">Pre√ßo (R$)</label>
                <input type="number" id="preco_total_mobile" name="preco_total" step="0.01" min="0" placeholder="0.00" class="mobile-input">
            </div>
        </div>

        <!-- Loja/Ve√≠culo -->
        <div class="mobile-section">
            <h3 id="mobile-section-tipo-title">Selecione</h3>
            <div id="loja_select_mobile" class="mobile-tipo-select" style="display: none;">
                <div class="mobile-form-group">
                    <label for="loja_id_mobile" class="mobile-label required">Loja</label>
                    <select id="loja_id_mobile" name="loja_id" class="mobile-input">
                        <option value="">Selecione a loja</option>
                        {% for loja in lojas %}
                            <option value="{{ loja.id }}" {% if request.args.get('loja_id')|int == loja.id %}selected{% endif %}>
                                {{ loja.nome }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div id="veiculo_select_mobile" class="mobile-tipo-select" style="display: none;">
                <div class="mobile-form-group">
                    <label for="veiculo_id_mobile" class="mobile-label required">Ve√≠culo</label>
                    <select id="veiculo_id_mobile" name="veiculo_id" class="mobile-input">
                        <option value="">Selecione o ve√≠culo</option>
                        {% for veiculo in veiculos %}
                            <option value="{{ veiculo.id }}" {% if request.args.get('veiculo_id')|int == veiculo.id %}selected{% endif %}>
                                {{ veiculo.placa }} - {{ veiculo.modelo }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- Fotos Mobile -->
        <div class="mobile-section">
            <h3>üì∑ Fotos</h3>
            <div class="mobile-upload-area" onclick="document.getElementById('fotos_mobile').click()">
                <input type="file" id="fotos_mobile" name="fotos" multiple accept="image/*" style="display: none;">
                <div class="mobile-upload-content">
                    <span class="mobile-upload-icon">üì∑</span>
                    <p>Adicionar Fotos</p>
                </div>
            </div>
            <div id="photo-preview-mobile" class="mobile-photo-preview"></div>
        </div>

        <!-- Bot√µes Mobile -->
        <div class="mobile-actions">
            <button type="submit" class="btn btn-primary mobile-btn">
                üíæ Cadastrar
            </button>
            <a href="{{ url_for('listar_manutencoes') }}" class="btn btn-secondary mobile-btn">
                ‚ùå Cancelar
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* ===== DESKTOP LAYOUT ===== */
    @media (min-width: 1024px) {
        .create-mobile {
            display: none !important;
        }
        
        .create-desktop {
            display: block;
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-xl);
        }
        
        .create-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }
        
        /* Header */
        .create-header {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
        }
        
        .header-icon {
            font-size: 3rem;
            flex-shrink: 0;
        }
        
        .header-content h1 {
            margin: 0 0 var(--space-xs) 0;
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }
        
        .header-content p {
            margin: 0;
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
        }
        
        /* Formul√°rio */
        .create-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }
        
        .form-section {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
            overflow: hidden;
        }
        
        .section-header {
            background: var(--primary-50);
            padding: var(--space-lg);
            border-bottom: 1px solid var(--color-border);
        }
        
        .section-header h3 {
            margin: 0;
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }
        
        .section-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--space-xs);
        }
        
        .section-content {
            padding: var(--space-xl);
        }
        
        .form-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-lg);
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }
        
        .form-label {
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            font-size: var(--font-size-sm);
        }
        
        .form-label.required::after {
            content: " *";
            color: var(--color-error);
        }
        
        .form-control {
            padding: var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: border-color var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--primary-100);
        }
        
        .tipo-select {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-2xl);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition);
            background: var(--gray-50);
        }
        
        .upload-area:hover {
            border-color: var(--color-primary);
            background: var(--primary-50);
        }
        
        .upload-content h4 {
            margin: var(--space-sm) 0 var(--space-xs) 0;
            color: var(--color-text);
        }
        
        .upload-content p {
            margin: 0 0 var(--space-xs) 0;
            color: var(--color-text-secondary);
        }
        
        .upload-content small {
            color: var(--color-text-secondary);
            font-size: var(--font-size-xs);
        }
        
        .upload-icon {
            font-size: 2rem;
        }
        
        /* Photo Preview */
        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }
        
        .preview-photo {
            position: relative;
            background: var(--gray-50);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--color-border);
        }
        
        .preview-photo img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        
        .preview-photo span {
            display: block;
            padding: var(--space-xs);
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            text-align: center;
            word-break: break-all;
        }
        
        .remove-photo {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--color-error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Bot√µes */
        .form-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-top: var(--space-xl);
        }
        
        .btn-large {
            padding: var(--space-lg) var(--space-xl);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
        }
    }
    
    /* ===== MOBILE LAYOUT ===== */
    @media (max-width: 1023px) {
        .create-desktop {
            display: none !important;
        }
        
        .create-mobile {
            display: block;
            padding: var(--space-md);
        }
        
        .mobile-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-md);
        }
        
        .mobile-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }
        
        .mobile-title h1 {
            margin: 0 0 var(--space-xs) 0;
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }
        
        .mobile-title p {
            margin: 0;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }
        
        .mobile-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }
        
        .mobile-section {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
        }
        
        .mobile-section h3 {
            margin: 0 0 var(--space-md) 0;
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }
        
        .mobile-form-group {
            margin-bottom: var(--space-md);
        }
        
        .mobile-form-group:last-child {
            margin-bottom: 0;
        }
        
        .mobile-label {
            display: block;
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-xs);
        }
        
        .mobile-label.required::after {
            content: " *";
            color: var(--color-error);
        }
        
        .mobile-input {
            width: 100%;
            padding: var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
        }
        
        .mobile-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        
        .mobile-tipo-select {
            animation: fadeIn 0.3s ease;
        }
        
        .mobile-upload-area {
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            cursor: pointer;
            background: var(--gray-50);
        }
        
        .mobile-upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .mobile-upload-icon {
            font-size: 1.5rem;
        }
        
        .mobile-photo-preview {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }
        
        .mobile-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-top: var(--space-lg);
        }
        
        .mobile-btn {
            width: 100%;
            padding: var(--space-md);
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Desktop functions
    function toggleTipoManutencao() {
        const tipo = document.getElementById('tipo').value;
        const lojaSelect = document.getElementById('loja_select');
        const veiculoSelect = document.getElementById('veiculo_select');
        const sectionTitle = document.getElementById('section-tipo-title');
        
        if (tipo === 'loja') {
            lojaSelect.style.display = 'block';
            veiculoSelect.style.display = 'none';
            sectionTitle.textContent = 'üè™ Selecionar Loja';
        } else if (tipo === 'veiculo') {
            lojaSelect.style.display = 'none';
            veiculoSelect.style.display = 'block';
            sectionTitle.textContent = 'üöó Selecionar Ve√≠culo';
        } else {
            lojaSelect.style.display = 'none';
            veiculoSelect.style.display = 'none';
            sectionTitle.textContent = 'Selecione o Tipo';
        }
    }
    
    // Mobile functions
    function toggleTipoManutencaoMobile() {
        const tipo = document.getElementById('tipo_mobile').value;
        const lojaSelect = document.getElementById('loja_select_mobile');
        const veiculoSelect = document.getElementById('veiculo_select_mobile');
        const sectionTitle = document.getElementById('mobile-section-tipo-title');
        
        if (tipo === 'loja') {
            lojaSelect.style.display = 'block';
            veiculoSelect.style.display = 'none';
            sectionTitle.textContent = 'üè™ Loja';
        } else if (tipo === 'veiculo') {
            lojaSelect.style.display = 'none';
            veiculoSelect.style.display = 'block';
            sectionTitle.textContent = 'üöó Ve√≠culo';
        } else {
            lojaSelect.style.display = 'none';
            veiculoSelect.style.display = 'none';
            sectionTitle.textContent = 'Selecione';
        }
    }
    
    // Photo preview functions
    function setupPhotoPreview(inputId, previewId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        
        input.addEventListener('change', function(e) {
            preview.innerHTML = '';
            const files = Array.from(e.target.files);
            
            files.forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const photoDiv = document.createElement('div');
                        photoDiv.className = previewId.includes('mobile') ? 'mobile-preview-photo' : 'preview-photo';
                        photoDiv.innerHTML = `
                            <img src="${e.target.result}" alt="Preview ${index + 1}">
                            <span>${file.name}</span>
                            <button type="button" onclick="this.parentElement.remove()" class="remove-photo">√ó</button>
                        `;
                        preview.appendChild(photoDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
    }
    
    // Drag and drop functions
    function setupDragAndDrop(areaClass, inputId) {
        const uploadArea = document.querySelector(areaClass);
        const input = document.getElementById(inputId);
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--color-primary)';
            uploadArea.style.background = 'var(--primary-50)';
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--color-border)';
            uploadArea.style.background = 'var(--gray-50)';
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--color-border)';
            uploadArea.style.background = 'var(--gray-50)';
            
            const files = e.dataTransfer.files;
            input.files = files;
            
            // Trigger change event
            const event = new Event('change', { bubbles: true });
            input.dispatchEvent(event);
        });
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Setup photo previews
        setupPhotoPreview('fotos', 'photo-preview');
        setupPhotoPreview('fotos_mobile', 'photo-preview-mobile');
        
        // Setup drag and drop
        setupDragAndDrop('.upload-area', 'fotos');
        setupDragAndDrop('.mobile-upload-area', 'fotos_mobile');
        
        // Sync mobile and desktop inputs
        const desktopInputs = ['tipo', 'data_manutencao', 'titulo', 'descricao', 'preco_total', 'loja_id', 'veiculo_id'];
        const mobileInputs = ['tipo_mobile', 'data_manutencao_mobile', 'titulo_mobile', 'descricao_mobile', 'preco_total_mobile', 'loja_id_mobile', 'veiculo_id_mobile'];
        
        desktopInputs.forEach((desktopId, index) => {
            const desktopInput = document.getElementById(desktopId);
            const mobileInput = document.getElementById(mobileInputs[index]);
            
            if (desktopInput && mobileInput) {
                desktopInput.addEventListener('change', function() {
                    mobileInput.value = this.value;
                    if (desktopId === 'tipo') {
                        toggleTipoManutencaoMobile();
                    }
                });
                
                mobileInput.addEventListener('change', function() {
                    desktopInput.value = this.value;
                    if (desktopId === 'tipo') {
                        toggleTipoManutencao();
                    }
                });
            }
        });
        
        // Initialize tipo selection
        toggleTipoManutencao();
        toggleTipoManutencaoMobile();
    });
</script>
{% endblock %}