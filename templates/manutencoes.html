{% extends "base.html" %}

{% block title %}Manutenções - Sistema de Manutenção{% endblock %}

{% block content %}
<!-- Enhanced Main Card -->
<div class="card">
    <div class="card-header">
        <span class="card-header-icon">🔧</span>
        <h3>Manutenções Realizadas</h3>
        {% if manutencoes %}<span class="badge">{{ manutencoes|length }}</span>{% endif %}
    </div>
    <div class="card-body">
        <!-- Enhanced Filters -->
        <div class="filters-section mb-4">
            <div class="filter-options">
                <div class="filter-tabs">
                    <a href="/manutencoes" class="filter-tab {% if tipo_atual == 'todas' %}active{% endif %}">
                        <span class="filter-icon">🔧</span>
                        <span>Todas</span>
                    </a>
                    <a href="/manutencoes?tipo=loja" class="filter-tab {% if tipo_atual == 'loja' %}active{% endif %}">
                        <span class="filter-icon">🏪</span>
                        <span>Lojas</span>
                    </a>
                    <a href="/manutencoes?tipo=veiculo" class="filter-tab {% if tipo_atual == 'veiculo' %}active{% endif %}">
                        <span class="filter-icon">🚗</span>
                        <span>Veículos</span>
                    </a>
                    <a href="/manutencoes/cadastrar" class="filter-tab primary">
                        <span class="filter-icon">➕</span>
                        <span>Nova</span>
                    </a>
                </div>
                <div class="filter-info">
                    <span class="filter-count">{{ manutencoes|length }} manutenção(ões) encontrada(s)</span>
                </div>
            </div>
        </div>
        
        {% if not manutencoes %}
            <div class="empty-state">
                <div class="empty-state-icon">🔧</div>
                <h4>Nenhuma manutenção registrada</h4>
                <p>Comece registrando a primeira manutenção do sistema.</p>
                <a href="/manutencoes/cadastrar" role="button" class="btn btn-primary">Registrar Primeira Manutenção</a>
            </div>
        {% else %}
            <!-- Enhanced Maintenance List -->
            <div class="maintenance-list">
                {% for manutencao in manutencoes %}
                    <div class="maintenance-card {{ manutencao.tipo }}">
                        <div class="maintenance-header">
                            <div class="maintenance-icon">
                                {% if manutencao.tipo == 'loja' %}🏪{% else %}🚗{% endif %}
                            </div>
                            <div class="maintenance-info">
                                <h4>{{ manutencao.titulo }}</h4>
                                <p class="date">
                                    📅 {{ manutencao.data_manutencao.strftime('%d/%m/%Y') }}
                                    {% if manutencao.tipo == 'loja' and manutencao.loja %}
                                        • 🏪 {{ manutencao.loja.nome }}
                                    {% elif manutencao.tipo == 'veiculo' and manutencao.veiculo %}
                                        • 🚗 {{ manutencao.veiculo.placa }} - {{ manutencao.veiculo.modelo }}
                                    {% endif %}
                                </p>
                                {% if manutencao.descricao %}
                                    <p class="maintenance-description">
                                        {{ manutencao.descricao[:150] }}{% if manutencao.descricao|length > 150 %}...{% endif %}
                                    </p>
                                {% endif %}
                                {% if manutencao.fotos %}
                                    <div class="maintenance-badges">
                                        <span class="info-badge">
                                            📷 {{ manutencao.fotos|length }} foto(s)
                                        </span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="maintenance-footer">
                            <div class="price">R$ {{ "%.2f"|format(manutencao.preco_total) }}</div>
                            <a href="/manutencoes/{{ manutencao.id }}" role="button" class="btn btn-secondary">
                                Ver Detalhes
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
